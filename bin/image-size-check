#!/usr/bin/env bash
set -e

get_base_path() {
  cd $(dirname $0) && cd .. && pwd
}
echoerr() { echo "$@" 1>&2; }

BASE_DIR="$(get_base_path)"
IMAGE_DIR="${BASE_DIR}/src/images/"
IMAGE_SIZE_THRESHOLD=1M

image_search_result=

new_images=$(git diff --cached --name-only --diff-filter=AM $IMAGE_DIR)
if [ ! -z "$new_images" ]; then
  image_search_result=$(echo $new_images | xargs du -ah -t $IMAGE_SIZE_THRESHOLD)
fi

if [ ! -z "$image_search_result" ]; then
  echoerr "Error: Found image(s) with size over $IMAGE_SIZE_THRESHOLD"
  echoerr "${image_search_result}"
  exit 1
fi

exit 0